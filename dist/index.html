<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link href="./css/tailwind.css" rel="stylesheet" />
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <title>ColorChords</title>
  </head>
  <body class="bg-main root flex justify-center">
    <script id="plane-vs" type="x-shader/x-vertex">
      precision mediump float;
      // those are the mandatory attributes that the lib sets
      attribute vec3 aVertexPosition;
      attribute vec2 aTextureCoord;
      // those are mandatory uniforms that the lib sets and that contain our model view and projection matrix
      uniform mat4 uMVMatrix;
      uniform mat4 uPMatrix;
      // our texture matrix that will handle image cover
      uniform mat4 uTextureMatrix0;
      // pass your vertex and texture coords to the fragment shader
      varying vec3 vVertexPosition;
      varying vec2 vTextureCoord;
      void main() {
          vec3 vertexPosition = aVertexPosition;
          gl_Position = uPMatrix * uMVMatrix * vec4(vertexPosition, 1.0);
          // set the varyings
          // here we use our texture matrix to calculate the accurate texture coords
          vTextureCoord = (uTextureMatrix0 * vec4(aTextureCoord, 0.0, 1.0)).xy;
          vVertexPosition = vertexPosition;
      }
    </script>
    <script id="plane-fs" type="x-shader/x-fragment">
        precision mediump float;

        varying vec2 vTextureCoord;

        uniform sampler2D uSampler0;
        uniform vec2 uResolution;
        uniform float noteAngles[100];
        uniform float noteOctaves[100];
        uniform float noteVelocities[100];
        uniform float numNotes;
        uniform float mobile;

        float circleSDF(
          float x,
          float y,
          float cx,
          float cy,
          float r)
      {
          // Sample coordinates relative to circle center.
          float _x = x - cx;
          float _y = y - cy;

          // Signed distance.
          return sqrt(_x * _x + _y *_y) - r;
      }

      vec4 addBorder(float d, float width, vec4 border, vec4 fill, vec4 background) {
          if (d < -width) {
              return fill;
          }
          if (d < 0.) {
              float t = -d / width;
              t = t * t;
              return mix(border,fill,t);
          }
          if (d < width) {
              float t = d / width;
              t = t * t;
              return mix(border,background,t);
          }
      }

      void main( )
      {
          // Normalized pixel coordinates (from 0 to 1)
          vec2 uv = mobile == 1. ? vTextureCoord*1.5-vec2(1.5/6.) : vTextureCoord;

          vec4 bc = vec4(1.);
          vec4 c = vec4(1.,0.,0.,1.);
          vec4 bg = vec4(1.);
          float borderThickness = .004;


          // Time varying pixel color
          vec4 image = texture2D(uSampler0, uv);

          vec4 col;

          for (int i=0;i<12;i++){
              if (i<int(numNotes)) {
              vec2 offset = vec2(sin(-noteAngles[i]),cos(noteAngles[i]))*noteVelocities[i]*.39;
              vec2 pos = uv + offset;
              float sdf = circleSDF(.5,.5,pos.x,pos.y,.05);
              c = texture2D(uSampler0,vec2(.5)-offset)+vec4(vec3(noteOctaves[i]),1.);
              c.w = 1.;

              col += (sdf > borderThickness) ? vec4(0.) : addBorder(sdf,borderThickness,bc,c,image);
              }
          }

          // Output to screen
          gl_FragColor =  col.w == 0. ? image : col;
          //gl_FragColor = vec4(col.z);
      }
    </script>
    <!-- app wrapper  -->
    <div class="w-full max-w-screen-2xl max-h-fit content-container">
      <!-- header   -->
      <header
        class="flex flex-row justify-between items-center w-full h-16 bg-main"
      >
        <h1
          class="text-xl text-highcontrast font-bold p-3 w-2/4 h-min 2xl:text-2xl"
        >
          ColorChords
        </h1>
        <!-- dark mode switch  -->
        <div
          class="toggle justify-self-end m-3 w-16 h-8 bg-focus flex items-center"
          data-parameter="theme"
        >
          <div
            class="switch switch-left w-6 h-6 m-1 bg-main overflow-hidden flex items-center justify-center transition-transform"
          >
            <div
              class="icon w-5 h-5 sun bg-mid transition-transform duration-500 rounded-full"
            >
              <div
                class="mask nomask w-5 h-5 bg-main inline-block rounded-full transition-transform"
              ></div>
            </div>
          </div>
        </div>
      </header>
      <!-- end header -->

      <!-- content container -->
      <main class="flex flex-col h-full md:flex-row w-full md:h-auto bg-focus">
        <!-- tab switcher     -->
        <aside
          class="bg-main w-full h-16 flex flex-col items-center justify-center fixed bottom-0 md:relative md:items-start md:h-sidebar md:w-24"
        >
          <hr class="bg-main md:bg-focus" />
          <!-- icons -->
          <div
            class="w-full flex flex-row md:flex-col items-center justify-between p-2 md:justify-start md:h-full md:gap-6"
          >
            <a href=""
              ><svg
                width="32"
                height="32"
                viewBox="0 0 32 32"
                class="fill-mid"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8.97245 6.15316C8.97246 4.11591 10.5046 2.39846 12.5277 2.16789L26.6503 0.558307C29.0289 0.287212 31.107 2.14191 31.1083 4.53716C31.1095 6.59842 29.5548 8.33437 27.5068 8.55849L13.3774 10.1047C11.0227 10.3624 8.97245 8.5232 8.97245 6.15316Z"
                />
                <path d="M8.95856 6.73706H11.3161V27.4294H8.95856V6.73706Z" />
                <path d="M28.8201 5.93326H31.1058V24.7987H28.8201V5.93326Z" />
                <path
                  d="M11.1305 27.4358C11.1305 29.9565 8.63885 32 5.56525 32C2.49165 32 0 29.9565 0 27.4358C0 24.915 2.49165 22.8716 5.56525 22.8716C8.63885 22.8716 11.1305 24.915 11.1305 27.4358Z"
                />
                <path
                  d="M31.1058 25.3058C31.1058 27.8266 28.6141 29.87 25.5405 29.87C22.4669 29.87 19.9753 27.8266 19.9753 25.3058C19.9753 22.7851 22.4669 20.7416 25.5405 20.7416C28.6141 20.7416 31.1058 22.7851 31.1058 25.3058Z"
                />
              </svg>
            </a>
            <a href="#"
              ><svg
                width="32"
                height="32"
                viewBox="0 0 32 32"
                class="fill-light"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M19.2224 25.979C20.478 28.3869 19.8648 30.6185 16.5653 31.7931C13.2657 32.9677 5.92032 28.8861 3.5421 25.979C-0.687229 20.8092 -0.138061 16.4546 0.282343 13.121L0.28235 13.1209L0.282352 13.1209C0.308934 12.9101 0.335001 12.7034 0.359313 12.5009C0.768124 9.09464 5.52769 0.607884 13.2657 0.0798551C21.0036 -0.448173 25.2683 1.6739 28.2452 5.51222C31.278 9.42261 32.2336 14.3956 31.9536 15.9071C31.3988 18.9022 30.3476 19.93 27.8364 19.93H22.9016C19.8648 19.93 17.9668 23.5711 19.2224 25.979ZM8.00968 17.8745C8.00968 18.9124 7.17299 19.7538 6.14089 19.7538C5.10878 19.7538 4.27209 18.9124 4.27209 17.8745C4.27209 16.8366 5.10878 15.9952 6.14089 15.9952C7.17299 15.9952 8.00968 16.8366 8.00968 17.8745ZM8.12648 11.708C9.15859 11.708 9.99528 10.8666 9.99528 9.82874C9.99528 8.79083 9.15859 7.94943 8.12648 7.94943C7.09438 7.94943 6.25769 8.79083 6.25769 9.82874C6.25769 10.8666 7.09438 11.708 8.12648 11.708ZM17.9961 5.83521C17.9961 6.87312 17.1594 7.71451 16.1273 7.71451C15.0952 7.71451 14.2585 6.87312 14.2585 5.83521C14.2585 4.7973 15.0952 3.9559 16.1273 3.9559C17.1594 3.9559 17.9961 4.7973 17.9961 5.83521ZM24.128 11.708C25.1601 11.708 25.9968 10.8666 25.9968 9.82874C25.9968 8.79083 25.1601 7.94943 24.128 7.94943C23.0959 7.94943 22.2592 8.79083 22.2592 9.82874C22.2592 10.8666 23.0959 11.708 24.128 11.708Z"
                />
              </svg>
            </a>
            <a href="#">
              <svg
                width="32"
                height="24"
                viewBox="0 0 32 24"
                class="fill-light"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M18.0588 0.764709L11 23.1177H13.9412L21 0.764709H18.0588Z"
                />
                <path
                  d="M10.5 14.5V18L0 13.5V10.5L10.5 6.5V10L4 12L10.5 14.5Z"
                />
                <path
                  d="M21.5 18V14.5L28 12L21.5 10V6.5L32 10.5V13.5L21.5 18Z"
                />
              </svg>
            </a>
            <a href="#">
              <svg
                width="32"
                height="32"
                viewBox="0 0 32 32"
                class="fill-light"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M16 32C24.8366 32 32 24.8366 32 16C32 7.16344 24.8366 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32ZM14.2855 25.4595H18.2464V12.7798H14.2855V25.4595ZM14.6605 8.12743C14.2542 8.4868 14.0511 8.94774 14.0511 9.51024C14.0511 10.0727 14.2542 10.5337 14.6605 10.8931C15.0667 11.2524 15.5941 11.4321 16.2425 11.4321C16.8909 11.4321 17.4183 11.2524 17.8245 10.8931C18.2308 10.5337 18.4339 10.0727 18.4339 9.51024C18.4339 8.94774 18.2308 8.4868 17.8245 8.12743C17.4183 7.76805 16.8909 7.58836 16.2425 7.58836C15.5941 7.58836 15.0667 7.76805 14.6605 8.12743Z"
                />
              </svg>
            </a>
          </div>
          <!-- end icons -->
        </aside>
        <!-- end tab switcher -->

        <!-- focus container -->
        <section class="w-full h-2/4 md:h-sidebar flex flex-col bg-focus">
          <!-- canvas  -->
          <div
            id="canvas"
            class="relative w-full h-96 md:h-96 flex-grow xl:mb-6 mx-auto flex justify-center items-center"
          >
            <div
              class="absolute plane w-canvasSmall h-canvasLarge md:w-canvasLarge md:h-canvasLarge"
            >
              <img src="./assets/colorwheel.png" class="hidden" />
            </div>
          </div>
          <!-- piano  -->
          <div
            id="piano_container"
            class="md:w-full h-auto justify-self-end w-mobilecontent mx-auto flex md:items-end"
          ></div>
        </section>
        <!-- end focus container  -->

        <!-- color preview  -->
        <div
          class="preview_container w-mobilecontent mx-auto md:w-64 md:h-full h-32 flex flex-row md:flex-col md:hidden flex-wrap md:flex-nowrap pt-3"
        ></div>
        <!-- end color preview  -->

        <!-- controls container  -->
        <aside
          class="controls-container flex flex-col mt-3 pb-16 md:pb-0 md:m-0 w-full md:w-64 xl:w-96 mx-auto md:h-sidebar bg-main 2xl:max-w-screen-md"
        >
          <hr />
          <!-- transpose  -->
          <div
            class="param rotation flex flex-wrap justify-between w-full mx-auto p-3 mb-3"
          >
            <label for="rotation" class="text-sm text-mid 2xl:text-2xl"
              >Transpose</label
            >
            <div class="rotation_value text-sm text-mid 2xl:text-2xl">0</div>
            <input
              type="range"
              min="-180"
              max="180"
              value="0"
              class="slider light w-full mt-3"
              name="rotation"
              id="rotation"
              data-parameter="transpose"
            />
          </div>
          <!-- end transpose  -->
          <hr />
          <!-- notes container  -->
          <ul
            class="notes md:overflow-y-scroll md:scrollbar md:scrollbar-thin md:h-full w-full mb-3"
            id="notes"
          >
            <!-- note  -->
            <li class="note w-full h-max p-3 md:flex md:flex-row">
              <div class="controls w-full">
                <!-- interval  -->
                <div class="interval-wrapper">
                  <select
                    name="interval"
                    class="param text-base text-mid 2xl:text-2xl font-semibold transition ease-in-out m-0 p-1 w-full mb-2 shadow-sm border border-light rounded focus:text-light focus:border-blue-600 focus:outline-none"
                    aria-label="Default select example"
                    value="1"
                  >
                    <option value="1" class="text-sm">Fundamental</option>
                    <option value="1.067" class="text-sm">Minor Second</option>
                    <option value="1.125" class="text-sm">Major Second</option>
                    <option value="1.200" class="text-sm">Minor Third</option>
                    <option value="1.250" class="text-sm">Major Third</option>
                    <option value="1.333" class="text-sm">
                      Perfect Fourth
                    </option>
                    <option value="1.414" class="text-sm">Tritone</option>
                    <option value="1.500" class="text-sm">Perfect Fifth</option>
                    <option value="1.600" class="text-sm">Minor Sixth</option>
                    <option value="1.666" class="text-sm">Major Sixth</option>
                    <option value="1.777" class="text-sm">Minor Seventh</option>
                    <option value="1.875" class="text-sm">Major Seventh</option>
                  </select>
                </div>
                <!-- end interval  -->

                <!-- color preview  -->
                <div
                  class="color_preview w-full h-6"
                  style="background-color: rgb(255, 5, 5)"
                ></div>

                <div class="flex flex-wrap justify-between w-full mt-3">
                  <label for="octave" class="text-sm text-mid 2xl:text-2xl"
                    >Octave</label
                  >
                  <div class="octave_value text-sm text-mid 2xl:text-2xl">
                    0
                  </div>
                  <input
                    type="range"
                    name="octave"
                    class="param octave slider light mt-3 mb-3 form-range w-full p-0 focus:outline-none focus:ring-0 focus:shadow-none"
                    min="-4"
                    max="4"
                    value="0"
                  />
                </div>
                <div class="flex flex-wrap justify-between w-full">
                  <label for="saturation" class="text-sm text-mid 2xl:text-2xl"
                    >Velocity</label
                  >
                  <div class="saturation_value text-sm text-mid 2xl:text-2xl">
                    100%
                  </div>
                  <input
                    type="range"
                    name="saturation"
                    class="param saturation slider light mt-3 mb-3 form-range w-full p-0 focus:outline-none focus:ring-0 focus:shadow-none"
                    min="0"
                    max="100"
                    value="100"
                  />
                </div>
              </div>
              <div
                class="color_preview hidden w-2/4 flex-grow ml-3 border-2 border-light"
              ></div>
            </li>
          </ul>
          <!-- end notes container  -->

          <!-- add note button  -->
          <button
            class="add_interval_button p-3 border border-mid mx-auto rounded text-mid 2xl:text-2xl font-medium justify-self-end mb-3"
          >
            Add Color
          </button>
          <!-- end add note button  -->
        </aside>
        <!-- end controls container  -->
      </main>
      <!-- end content container  -->
    </div>
    <!-- end app container  -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
    <script src="bundle.js"></script>
  </body>
</html>
